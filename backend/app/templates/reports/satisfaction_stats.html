{% extends "dashboard_layout.html" %}
{% block title %}滿意度統計{% endblock %}

{% block content %}
<style>
  .card-clean{ border:0; box-shadow:0 6px 20px rgba(15,23,42,.06); border-radius:14px; }
  .page-title{ font-weight:800; letter-spacing:.2px; }
  .muted{ color:#64748b; }
  .chart-container{ height:320px; }
</style>

<div class="card card-clean mb-4">
  <div class="card-body">
    <h2 class="page-title mb-3">滿意度統計</h2>
    <p class="muted mb-4">統計區間內，依據問卷回覆的整體滿意度分數（1~5 分）進行分布與平均分數統計。</p>

    <div class="row g-4">
      <div class="col-md-6">
        <div class="chart-container">
          <canvas id="scoreChart"></canvas>
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column justify-content-center">
        <div class="fs-5">回覆總數：<strong>{{ total }}</strong></div>
        <div class="fs-5">平均分數：<strong>{{ avg_score }}</strong> / 5</div>
        <ul class="mt-3">
          {% for i in range(5,0,-1) %}
            <li>{{ i }} 分：{{ data[i] }} 筆 ({{ '%.1f' % ( (data[i]/total*100) if total>0 else 0 ) }}%)</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('scoreChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['1 分','2 分','3 分','4 分','5 分'],
      datasets: [{
        label: '回覆數',
        data: [{{ data[1] }}, {{ data[2] }}, {{ data[3] }}, {{ data[4] }}, {{ data[5] }}],
        backgroundColor: 'rgba(82,117,134,0.7)',
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });
</script>
{% endblock %}
